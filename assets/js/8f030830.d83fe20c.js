"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4423],{1184(e,n,t){t.d(n,{R:()=>r,x:()=>o});var i=t(4041);const a={},s=i.createContext(a);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},8192(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"development","title":"Development","description":"Documentation","source":"@site/docs/development.md","sourceDirName":".","slug":"/development","permalink":"/directory/docs/development","draft":false,"unlisted":false,"editUrl":"https://github.com/Wildboar-Software/directory/edit/main/website/docs/development.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Versioning","permalink":"/directory/docs/versioning"},"next":{"title":"Support / Help","permalink":"/directory/docs/support"}}');var a=t(1085),s=t(1184);const r={},o="Development",l={},c=[{value:"Documentation",id:"documentation",level:2},{value:"Building",id:"building",level:2},{value:"Debian Package",id:"debian-package",level:3},{value:"Snapcraft Snap",id:"snapcraft-snap",level:3},{value:"RPM Package",id:"rpm-package",level:3},{value:"Alpine APK Package",id:"alpine-apk-package",level:3},{value:"Arch Package",id:"arch-package",level:3},{value:"Brew Formula",id:"brew-formula",level:3},{value:"CI",id:"ci",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"development",children:"Development"})}),"\n",(0,a.jsx)(n.h2,{id:"documentation",children:"Documentation"}),"\n",(0,a.jsxs)(n.p,{children:["Note that for all changes you make to ",(0,a.jsx)(n.code,{children:"meerkat-docs"}),", there may be equivalent\ndocumentation in ",(0,a.jsx)(n.code,{children:"docs"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"building",children:"Building"}),"\n",(0,a.jsx)(n.p,{children:"Very soon, Meerkat DSA will build these packages in CI/CD. A lot of these\napproaches are messy just because I had to build in one of each different\ndistro's container images and install in said images so I can smoke-test\ninstallation into a real system. Eventually this will be cleaned up."}),"\n",(0,a.jsx)(n.h3,{id:"debian-package",children:"Debian Package"}),"\n",(0,a.jsxs)(n.p,{children:["Run ",(0,a.jsx)(n.code,{children:"./scripts/build-debian.sh"}),", then run ",(0,a.jsx)(n.code,{children:"dpkg-buildpackage -us -uc"}),", both in\nthe root directory of the project. Note that this will clean the source tree, so\nyou will lose some files and folders like ",(0,a.jsx)(n.code,{children:"node_modules"})," and ",(0,a.jsx)(n.code,{children:"dist"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["If you build this directly on the host system, you will have to make sure that\nthe version of NodeJS you compile against is the exact same one that it actually\nruns on. The Debian package is hard-coded to run ",(0,a.jsx)(n.code,{children:"/usr/bin/node"}),", but a lot of\nNodeJS installations nowadays use NVM to version NodeJS. Run ",(0,a.jsx)(n.code,{children:"which node"})," to\nsee if you're using it. You might need to run ",(0,a.jsx)(n.code,{children:"nvm use 20.19.1"})," (or something\nlike that) ",(0,a.jsx)(n.em,{children:"before"})," you even build the package. Then run it."]}),"\n",(0,a.jsx)(n.h3,{id:"snapcraft-snap",children:"Snapcraft Snap"}),"\n",(0,a.jsxs)(n.p,{children:["Build with ",(0,a.jsx)(n.code,{children:"snapcraft pack -v"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Install with ",(0,a.jsx)(n.code,{children:"snap install ./meerkat-dsa_4.0.0_amd64.snap --dangerous"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["It seems like it automatically starts running on installation. Run\n",(0,a.jsx)(n.code,{children:"journalctl -xe"})," to see logs for it."]}),"\n",(0,a.jsxs)(n.p,{children:["Run a shell with ",(0,a.jsx)(n.code,{children:"snap run --shell meerkat-dsa.meerkat-dsa-app"})," and you can\npeek around in the VM to identify build issues."]}),"\n",(0,a.jsx)(n.h3,{id:"rpm-package",children:"RPM Package"}),"\n",(0,a.jsx)(n.p,{children:"Run"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'./scripts/build-rpm.sh\npodman build -t meerkat-rpm-builder -f pkg/rpmbuilder.dockerfile .\npodman run --rm -it -v "$PWD:/src" -v "$PWD/rpmbuild:/root/rpmbuild" meerkat-rpm-builder rpmbuild -ba /src/pkg/meerkat.spec\n'})}),"\n",(0,a.jsxs)(n.p,{children:["If using Docker, replace ",(0,a.jsx)(n.code,{children:"podman"})," with ",(0,a.jsx)(n.code,{children:"docker"}),". It should be a drop-in\nreplacement."]}),"\n",(0,a.jsxs)(n.p,{children:["You might see a ton of warnings pertaining to the executable bit being set on\nJavascript files. This is a bug with JSR, which I reported\n",(0,a.jsx)(n.a,{href:"https://github.com/jsr-io/jsr/issues/1246",children:"here"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Note that the ",(0,a.jsx)(n.code,{children:"fedora"})," container image has a file ",(0,a.jsx)(n.code,{children:"/etc/dnf/dnf.conf"})," that, by\ndefault excludes the installation of documentation from RPMs. You will need to\nmodify the ",(0,a.jsx)(n.code,{children:"tsflags"})," option to remove ",(0,a.jsx)(n.code,{children:"nodocs"})," if you want to see your man pages\nshow up. This took me ",(0,a.jsx)(n.em,{children:"days"})," to figure out."]}),"\n",(0,a.jsx)(n.h3,{id:"alpine-apk-package",children:"Alpine APK Package"}),"\n",(0,a.jsx)(n.p,{children:"You have to run the script twice. Exit out when it brings you into the\ncontainer shell for the first time."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./scripts/build-apk.sh\npodman build -t apkbuilder -f pkg/apkbuilder.dockerfile .\n./scripts/build-apk.sh\nabuild checksum # automatically applies the checksum to APKBUILD\nabuild # actually build it all\n# Your packages end up here\napk add --allow-untrusted packages/home/x86_64/meerkat-dsa-4.0.0-r0.apk\n"})}),"\n",(0,a.jsx)(n.h3,{id:"arch-package",children:"Arch Package"}),"\n",(0,a.jsxs)(n.p,{children:["As with so many other containerized distros, it seems that the ",(0,a.jsx)(n.code,{children:"archlinux"})," image\nalso refuses to install ",(0,a.jsx)(n.code,{children:"man"})," pages by default. Check ",(0,a.jsx)(n.code,{children:"/etc/pacman.conf"})," and\nyou'll see a ",(0,a.jsx)(n.code,{children:"NoExtract"})," line with the ",(0,a.jsx)(n.code,{children:"man"})," pages directory in it. You will\nwant to remove this if you plan to install the docs and verify that they work."]}),"\n",(0,a.jsx)(n.p,{children:"You have to run the script twice. Exit out when it brings you into the\ncontainer shell for the first time."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./scripts/build-arch.sh\npodman build -t archbuilder -f pkg/archbuilder.dockerfile .\n./scripts/build-arch.sh\n"})}),"\n",(0,a.jsxs)(n.p,{children:["In the shell of that container, run ",(0,a.jsx)(n.code,{children:"makepkg -g >> PKGBUILD"})," to generate a\nsignature over the source and append it to ",(0,a.jsx)(n.code,{children:"PKGBUILD"}),". Then run ",(0,a.jsx)(n.code,{children:"makepkg -si"}),"\nto build the packages. From memory, I think this step might be interactive."]}),"\n",(0,a.jsxs)(n.p,{children:["Install ",(0,a.jsx)(n.code,{children:"devtools"})," and run ",(0,a.jsx)(n.code,{children:"makerepropkg meerkat-dsa-4.0.0-0-x86_64.pkg.tar.zst"}),"\nto check if the package is reproducible. I got a 503 and\n",(0,a.jsx)(n.code,{children:"failed to retrieve meerkat-dsa-docs-4.0.0-0-x86_64"}),", so I think I won't be able\nto check this until its actually published. Not sure. I eventually want to make\nthis reproducible."]}),"\n",(0,a.jsx)(n.h3,{id:"brew-formula",children:"Brew Formula"}),"\n",(0,a.jsx)(n.p,{children:"To build and install the Brew formula, you'll have to be either on a Mac OS\ndesktop device or on a systemd-using Linux distro, such as Ubuntu or Linux Mint."}),"\n",(0,a.jsxs)(n.p,{children:["For all the following commands, replace ",(0,a.jsx)(n.code,{children:"<anyname>"})," with your choice of value:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Run ",(0,a.jsx)(n.code,{children:"brew tap-new <anyname>/meerkat"})," to create a new local tap"]}),"\n",(0,a.jsxs)(n.li,{children:["Run ",(0,a.jsx)(n.code,{children:"cp pkg/meerkat_dsa.rb /home/linuxbrew/.linuxbrew/Homebrew/Library/Taps/<anyname>/homebrew-meerkat/Formula"}),"\nto manually copy the formula into it."]}),"\n",(0,a.jsxs)(n.li,{children:["Run ",(0,a.jsx)(n.code,{children:"brew install -vd <anyname>/meerkat/meerkat_dsa"})]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["To make sure it's still acceptable, run\n",(0,a.jsx)(n.code,{children:"brew audit --new <anyname>/meerkat/meerkat_dsa"})," and fix any errors you see\n(except the one about ",(0,a.jsx)(n.code,{children:"std_npm_args"}),"; I don't really think that is a valid\nrequirement in my case)."]}),"\n",(0,a.jsxs)(n.p,{children:["Run ",(0,a.jsx)(n.code,{children:"brew services start <anyname>/meerkat/meerkat_dsa"})," to start the DSA\nlocally. Run ",(0,a.jsx)(n.code,{children:"journalctl --user -e"})," and make sure the DSA starts up correctly."]}),"\n",(0,a.jsxs)(n.p,{children:["Run ",(0,a.jsx)(n.code,{children:"brew uninstall meerkat_dsa"})," to uninstall it from your system."]}),"\n",(0,a.jsxs)(n.p,{children:["Run ",(0,a.jsx)(n.code,{children:"brew test -d meerkat_dsa"})," to run tests after it is installed."]}),"\n",(0,a.jsx)(n.h2,{id:"ci",children:"CI"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/actions/runner-images",children:"Here"})," are the different runners\nGitHub supports. Unfortunately, it looks like you get Windows, MacOS, and\nUbuntu. So my ability to test the creation of software packages in CI will be a\nbit limited, unless I tap into containers. GitHub natively supports running\nworkflows in containers instead. It will be virtually impossible to test this on\nthe BSDs except manually."]}),"\n",(0,a.jsxs)(n.p,{children:["Note that there are no Docker images that even emulate MacOS, as described\n",(0,a.jsx)(n.a,{href:"https://apple.stackexchange.com/questions/465642/base-macos-docker-images",children:"here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);