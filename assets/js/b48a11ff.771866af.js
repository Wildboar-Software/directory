"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[822],{1184(e,t,n){n.d(t,{R:()=>r,x:()=>o});var a=n(4041);const s={},i=a.createContext(s);function r(e){const t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:t},e.children)}},2147(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"database","title":"Database Administration","description":"How to Customize the Database Schema","source":"@site/docs/database.md","sourceDirName":".","slug":"/database","permalink":"/directory/docs/database","draft":false,"unlisted":false,"editUrl":"https://github.com/Wildboar-Software/directory/edit/main/website/docs/database.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"The Web Admin Console","permalink":"/directory/docs/webadmin"},"next":{"title":"Authorization","permalink":"/directory/docs/authorization"}}');var s=n(1085),i=n(1184);const r={},o="Database Administration",d={},l=[{value:"How to Customize the Database Schema",id:"how-to-customize-the-database-schema",level:2},{value:"Maximum entries",id:"maximum-entries",level:2},{value:"Bulk Insertion",id:"bulk-insertion",level:2},{value:"Bulk Insertion Mode",id:"bulk-insertion-mode",level:3}];function h(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"database-administration",children:"Database Administration"})}),"\n",(0,s.jsx)(t.h2,{id:"how-to-customize-the-database-schema",children:"How to Customize the Database Schema"}),"\n",(0,s.jsx)(t.p,{children:"Meerkat DSA uses Prisma as an ORM for interacting with the database. If you want\r\nto change the database schema, you may do so using the normal methods for\r\nupdating Prisma schema and the Prisma client."}),"\n",(0,s.jsx)(t.h2,{id:"maximum-entries",children:"Maximum entries"}),"\n",(0,s.jsx)(t.p,{children:"There is a maximum of 2.1 billion entries possible in the database. There is\r\nalmost no way any reasonable use case would ever use this many entries, and the\r\nDIT should be spread across multiple DSAs long before this maximum is reached."}),"\n",(0,s.jsx)(t.p,{children:'Note that entries are soft-deleted, meaning that they are not truly "deleted"\r\nfrom the database, but merely marked as deleted with a deletion timestamp.'}),"\n",(0,s.jsx)(t.p,{children:"If you run low on storage space, deleting these soft-deleted entries can be\r\na good way to reclaim some space."}),"\n",(0,s.jsx)(t.h2,{id:"bulk-insertion",children:"Bulk Insertion"}),"\n",(0,s.jsxs)(t.p,{children:["In Meerkat DSA, you can insert a large number of entries either through the\r\nDirectory Access Protocol (DAP) ",(0,s.jsx)(t.code,{children:"addEntry"})," operation, or you can bypass the\r\nDirectory protocols entirely and insert entries directly into the database."]}),"\n",(0,s.jsx)(t.p,{children:"The former method is good for when you need to insert up to 100,000 entries or\r\nso. The former method will ensure that you do not violate schema, object class\r\ndefinitions, and access controls, but it will be much slower than the\r\nalternative. If you use this method, you should ensure that the NodeJS runtime\r\nis not using debugging and that the client you are using for the insertion is\r\nnot authenticating between each entry addition; in other words, you should\r\nensure that the same authenticated session is used to insert all entries."}),"\n",(0,s.jsx)(t.p,{children:"Direct insertion into the database, on the other hand, will be much faster, but\r\nyou have a greater chance of screwing up and not inserting what you expected."}),"\n",(0,s.jsxs)(t.p,{children:["Note that entries will not be validated when they are read and searched--not\r\nwhen they are inserted. This means that, for instance, if you have a violation\r\nof the object class (such as by missing a mandatory attribute), Meerkat DSA will\r\nbe oblivious to this change, and there will usually not be any degredation of\r\nfunctionality, but entries could still be technically incorrect. Be aware that\r\nthere ",(0,s.jsx)(t.em,{children:"are"})," cases where invalid entries could have catastrophic effects:\r\ninserting an invalid access control subentry, for instance, could introduce a\r\nsevere security vulnerability!"]}),"\n",(0,s.jsx)(t.h3,{id:"bulk-insertion-mode",children:"Bulk Insertion Mode"}),"\n",(0,s.jsxs)(t.p,{children:["Bulk insertion mode can be enabled by setting the ",(0,s.jsx)(t.code,{children:"MEERKAT_BULK_INSERT_MODE"}),"\r\nenvironment variable to ",(0,s.jsx)(t.code,{children:"1"}),". This is a dangerous setting and should only be used\r\nwhen the DSA is not exposed to the public Internet, because all access controls\r\nare disabled. This will only make insertions very slightly faster."]}),"\n",(0,s.jsx)(t.p,{children:"According to empirical experiments, it seems that you should be able to insert\r\nabout 10 entries per second when using bulk insertion mode."})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);